---
title: "`r params$exposure` posthoc analysis"
date: '`r paste("Updated on", Sys.Date())`'
output: 
  html_document:
    css: posthoc_report.css
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: false
    toc_depth: 2
    theme: "paper"
params:
  exposure: "active_met_875"
  covariates: !r c("age_ref_imp", "sex", "energytot_imp", "pc1", "pc2", "pc3", "study_gxe")
  hrc_version: "v3.1"
  path: "/media/work/gwis_test"
---

  
```{r setup, include=FALSE}
# chunk options
knitr::opts_chunk$set(
  echo = F,
  message = F,
  warning = F,
  error = F
)

# load packages and define wrapper functions
library(tidyverse)
library(data.table)
library(forcats)
library(ggplot2)
library(qqman)
library(rlang)
library(figifs)
library(DT)
library(grid)
library(stargazer)
library(kableExtra)
library(formattable)
library(glue)

# parameters
exposure = params$exposure
covariates = c("age_ref_imp",
               "sex",
               "energytot_imp",
               "pc1",
               "pc2",
               "pc3",
               "study_gxe")
hrc_version = params$hrc_version
path = glue("/media/work/gwis_test/{params$exposure}")
```

# Description

### Follow-up analyses of GWIS findings  
- Table of significant and suggestive (1df GxE only) ```r params$exposure``` GWIS findings  
- GxE models stratified by study_design and tumor site (proximal, distal, rectal)  
- GxE models with additional covariate sets (might do this for aspirin ..)  
- Odds ratios stratified by exposure and genotype  
- Plots of model predicted outcome by 1 unit increase of exposure/allelic dosage  
- Locuszoom plot   
- Functional annotation plot   

---

<!-- read script containing useful chunks -->
```{r child = 'chunks.Rmd'}
```


<!-- compiled chunks -->
# Two-step findings

```{r results = 'asis', out.width="50%"}
statistic = 'chiSqGxE'

# list of SNPs
snps <- c("15:33001734:T:A", "15:32994756:T:C")
snps <- paste0('chr', gsub(":", "_", snps))

# see chunks.Rmd for names
run_functions <- function(snp) {
  <<allele_freq_plots>>
    <<gxe_stratified_sex>>
    <<gxe_stratified_study>>
    <<gxe_stratified_tumorsite>>
    <<stratified_or_cat>>
    <<locuszoom_plots>>
    <<functional_plots>>
}

# run
walk(snps, ~ run_functions(.x))
```




<!-- # Two-step finding (expectation based) -->
<!-- ```{r, results = 'asis'} -->
<!-- assign("method", "chiSqGxE", child_env) -->
<!-- snps_out <- paste0('chr', gsub(":", "_", c("15:33001734:T:A", "15:32994756:T:C", "15:32994777:C:T", "15:32995298:C:A", "15:32995764:C:G"))) -->

<!-- res <- lapply(snps_out, function(snp) { -->
<!--   assign("snp", snp, child_env) -->
<!--   knitr::knit_child(glue('posthoc/posthoc_child.Rmd'), envir = child_env, quiet = TRUE) -->
<!--   }) -->

<!-- cat(unlist(res), sep = '\n') -->
<!-- ``` -->



<!-- # G|E association in combined case/control sample -->
<!-- ```{r, results = 'asis'} -->
<!-- assign("method", "chiSqGE", child_env) -->
<!-- snps_out <- paste0('chr', gsub(":", "_", c("13:61572969:G:A"))) -->

<!-- res <- lapply(snps_out, function(snp) { -->
<!--   assign("snp", snp, child_env) -->
<!--   knitr::knit_child(glue('posthoc/posthoc_child_active_met_875_ge.Rmd'), envir = child_env, quiet = TRUE) -->
<!--   }) -->

<!-- cat(unlist(res), sep = '\n') -->

<!-- ``` -->