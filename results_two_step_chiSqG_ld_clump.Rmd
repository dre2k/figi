
```{r include = F}

twostep_wrapper <- function(exposure, step1_statistic, filename_suffix = "") {
  knitr::include_graphics(paste0("/media/work/gwis/posthoc/", exposure, "/twostep_wht_", step1_statistic, "_", exposure, filename_suffix, ".png"))
}


# some modifications compared to those of 1df tests
significant_results_table_wrapper <- function(exposure, step1_statistic, filename_suffix = "") {
  
  x <- readRDS(paste0("/media/work/gwis/posthoc/", exposure, "/significant_results_dataframe_twostep_wht_", step1_statistic, "_", exposure, filename_suffix, ".rds")) %>% 
    rename(Bin = grp) %>% 
    mutate(Step1p = formatC(step1p, format = "e", digits = 2),
           Step2p = formatC(step2p, format = "e", digits = 2)) %>% 
    dplyr::select(SNP, Chromosome, Location, Reference, Alternate, Subjects, Cases, Bin, Step1p, Step2p)
  
  datatable(x, filter = 'top', options = list(pageLength = 10, autoWidth = T))
}

```


### Step1 D|G
```{r , echo=FALSE, out.width = '100%'}
twostep_wrapper(exposure = params$exposure, step1_statistic = 'chiSqG', filename_suffix = "_chiSqG_ld_clump")
significant_results_table_wrapper(exposure = params$exposure, step1_statistic = 'chiSqG', filename_suffix = "_chiSqG_ld_clump")
```

### Step1 D|G (no GWAS)
```{r , echo=FALSE, out.width = '100%'}
twostep_wrapper(exposure = params$exposure, step1_statistic = 'chiSqG', filename_suffix = "_chiSqG_ld_clump_no_gwas")
significant_results_table_wrapper(exposure = params$exposure, step1_statistic = 'chiSqG', filename_suffix = "_chiSqG_ld_clump_no_gwas")
```

### Step1 G|E
```{r , echo=FALSE, out.width = '100%'}
twostep_wrapper(exposure = params$exposure, step1_statistic = 'chiSqGE', filename_suffix = "_chiSqG_ld_clump")
significant_results_table_wrapper(exposure = params$exposure, step1_statistic = 'chiSqGE', filename_suffix = "_chiSqG_ld_clump")
```

### Step1 G|E (no GWAS)
```{r , echo=FALSE, out.width = '100%'}
twostep_wrapper(exposure = params$exposure, step1_statistic = 'chiSqGE', filename_suffix = "_chiSqG_ld_clump_no_gwas")
significant_results_table_wrapper(exposure = params$exposure, step1_statistic = 'chiSqGE', filename_suffix = "_chiSqG_ld_clump_no_gwas")
```

### Step1 EDGE
```{r , echo=FALSE, out.width = '100%'}
twostep_wrapper(exposure = params$exposure, step1_statistic = 'chiSqEDGE', filename_suffix = "_chiSqG_ld_clump")
significant_results_table_wrapper(exposure = params$exposure, step1_statistic = 'chiSqEDGE', filename_suffix = "_chiSqG_ld_clump")
```

### Step1 EDGE (no GWAS)
```{r , echo=FALSE, out.width = '100%'}
twostep_wrapper(exposure = params$exposure, step1_statistic = 'chiSqEDGE', filename_suffix = "_chiSqG_ld_clump_no_gwas")
significant_results_table_wrapper(exposure = params$exposure, step1_statistic = 'chiSqEDGE', filename_suffix = "_chiSqG_ld_clump_no_gwas")
```
