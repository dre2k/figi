---
title: "FIGI GWIS Results"
date: '`r paste("Updated on", Sys.Date())`'
output: 
  html_document:
    toc: true
    toc_float: true
    toc_depth: 2
    theme: "united"
params:
  exposure: ""
  hrc_version: "v2.3"
  covariates: !r c("age_ref_imp", "sex", "study_gxe", "pc1", "pc2", "pc3")
---

<!-- #===============================# -->
<!-- diab -->
<!-- additional covariates (bmi) for main effects meta and pooled analyses -->
<!-- #===============================# -->

```{r, include = F}
covariates_meta_analysis <- sort(params$covariates[which(!params$covariates %in% c("study_gxe", paste0(rep('pc', 20), seq(1, 20))))])

create_suffix <- function(covar, strata = '') {
  if(strata == '') {
    paste0(paste0(covar, collapse = '_'), strata, ".png")
  } else {
    paste0(paste0(covar, collapse = '_'), "_", strata, ".png")
  }
}

create_suffix_pooled <- function(covar, strata) {
  paste0(paste0(sort(covar), collapse = '_'), "_stratified_", strata, ".html")
}

# portion that's specific for this exposure
covariates_meta_analysis_bmi <- sort(c(covariates_meta_analysis, 'bmi'))
covariates_pooled_analysis_bmi <- sort(c(params$covariates, 'bmi'))
```

<!-- ```{r, echo=FALSE, results="asis", eval=diab} -->
<!-- cat(paste0("### BMI adjustment {.tabset}", collapse = '\n')) -->
<!-- ``` -->

<!-- ```{r, echo=FALSE, results="asis", eval=diab} -->
<!-- cat(paste0("#### Meta-analysis", collapse = '\n')) -->
<!-- ``` -->

### BMI adjustment

#### Meta-analysis {.tabset}

##### All
```{r  out.width="49%", echo = F, message = F, warning = F, cache = F}
all <- create_suffix(covariates_meta_analysis_bmi)

knitr::include_graphics(paste0(output_dir, "meta_analysis_", params$exposure, "_", all))
knitr::include_graphics(paste0(output_dir, "funnel_plot_", params$exposure, "_", all))
```

##### Sex
```{r  out.width="49%", echo = F, message = F, warning = F, cache = F}
females <- create_suffix(covariates_meta_analysis_bmi, 'females')
males <- create_suffix(covariates_meta_analysis_bmi, 'males')

knitr::include_graphics(c(paste0(output_dir, "meta_analysis_", params$exposure, "_", females),
                          paste0(output_dir, "meta_analysis_", params$exposure, "_", males)))
knitr::include_graphics(c(paste0(output_dir, "funnel_plot_", params$exposure, "_", females),
                          paste0(output_dir, "funnel_plot_", params$exposure,  "_", males)))
```

##### Tumor Site
```{r  out.width="49%", echo = F, message = F, warning = F, cache = F}
proximal <- create_suffix(covariates_meta_analysis_bmi, 'proximal')
distal <- create_suffix(covariates_meta_analysis_bmi, 'distal')
rectal <- create_suffix(covariates_meta_analysis_bmi, 'rectal')


knitr::include_graphics(c(paste0(output_dir, "meta_analysis_", params$exposure, "_", proximal),
                          paste0(output_dir, "meta_analysis_", params$exposure, "_", distal),
                          paste0(output_dir, "meta_analysis_", params$exposure, "_", rectal)))
knitr::include_graphics(c(paste0(output_dir, "funnel_plot_", params$exposure, "_", proximal),
                          paste0(output_dir, "funnel_plot_", params$exposure,  "_", distal),
                          paste0(output_dir, "funnel_plot_", params$exposure,  "_", rectal)))
```



#### Pooled Analysis {.tabset}

##### Sex
```{r, results = 'asis', echo = F, quote = F, message = F}
pooled_suffix_sex <- create_suffix_pooled(covariates_pooled_analysis_bmi, 'sex')

rawHTML <- paste(readLines(paste0(output_dir, "main_effects_pooled_analysis_", params$exposure, "_", pooled_suffix_sex)))
cat(paste(rawHTML, collapse = "\n"), "\n")
```

<br>

---

<br>


##### Tumor site
```{r, results = 'asis', echo = F, quote = F, message = F}
pooled_suffix_tumor_site <- create_suffix_pooled(covariates_pooled_analysis_bmi, 'cancer_site_sum2')

rawHTML <- paste(readLines(paste0(output_dir, "main_effects_pooled_analysis_", params$exposure, "_", pooled_suffix_tumor_site)))
cat(paste(rawHTML, collapse = "\n"), "\n")
```

<br>

---

<br>


##### Study design
```{r, results = 'asis', echo = F, quote = F, message = F}
pooled_suffix_study_design <- create_suffix_pooled(covariates_pooled_analysis_bmi, 'study_design')

rawHTML <- paste(readLines(paste0(output_dir, "main_effects_pooled_analysis_", params$exposure, "_", pooled_suffix_study_design)))
cat(paste(rawHTML, collapse = "\n"), "\n")
```

<br>

---

<br>